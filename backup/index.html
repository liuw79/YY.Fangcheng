<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â≠¶ÊñπÁ®ãÂ∞èÊ∏∏Êàè</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
</head>
<body>
    <!-- Ê∏∏Êàè‰∏ªÂÆπÂô® -->
    <div id="gameContainer">
        <!-- Â§¥ÈÉ®ÂØºËà™ -->
        <header id="gameHeader">
            <div class="header-left">
                <h1 class="game-title">üéØ Â≠¶ÊñπÁ®ãÂ∞èÊ∏∏Êàè</h1>
            </div>
            <div class="header-right">
                <div class="progress-info">
                    <span class="stage-info">Á¨¨<span id="currentStage">1</span>Èò∂ÊÆµ</span>
                    <span class="level-info">Á¨¨<span id="currentLevel">1</span>ÂÖ≥</span>
                </div>
                <div class="score-info">
                    <span class="score">ÂæóÂàÜ: <span id="totalScore">0</span></span>
                </div>
            </div>
        </header>

        <!-- ‰∏ªÊ∏∏ÊàèÂå∫Âüü -->
        <main id="gameMain">
            <!-- ÂºÄÂßãÁïåÈù¢ -->
            <div id="startScreen" class="screen active">
                <div class="welcome-container">
                    <h2 class="welcome-title">Ê¨¢ËøéÊù•Âà∞ÊñπÁ®ã‰∏ñÁïåÔºÅ</h2>
                    <p class="welcome-subtitle">ËÆ©Êàë‰ª¨‰∏ÄËµ∑Â≠¶‰π†Áî®ÊñπÁ®ãËß£ÂÜ≥ÈóÆÈ¢òÂêßÔºÅ</p>
                    
                    <div class="game-controls">
                        <button id="startGame" class="btn btn-primary btn-large" onclick="game.showStageSelection()">ÂºÄÂßãÊ∏∏Êàè</button>
                        <button id="showHelp" class="btn btn-secondary">Ê∏∏ÊàèËØ¥Êòé</button>
                    </div>
                    
                    <div class="stage-selection">
                        <div class="stage-card" data-stage="1">
                            <div class="stage-icon">‚öñÔ∏è</div>
                            <h3>Â§©Âπ≥Ê∏∏Êàè</h3>
                            <p>ÁêÜËß£Á≠âÈáèÂÖ≥Á≥ª</p>
                            <div class="stage-progress">
                                <span class="progress-text">ËøõÂ∫¶: <span class="progress-count">0/8</span></span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stage-card" data-stage="2">
                            <div class="stage-icon">üì¶</div>
                            <h3>È≠îÊ≥ïÁõíÂ≠ê</h3>
                            <p>ËÆ§ËØÜÊú™Áü•Êï∞</p>
                            <div class="stage-progress">
                                <span class="progress-text">ËøõÂ∫¶: <span class="progress-count">0/10</span></span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stage-card" data-stage="3">
                            <div class="stage-icon">üìö</div>
                            <h3>ÊïÖ‰∫ãÊñπÁ®ã</h3>
                            <p>ÂÆûÈôÖÈóÆÈ¢òÂ∫îÁî®</p>
                            <div class="stage-progress">
                                <span class="progress-text">ËøõÂ∫¶: <span class="progress-count">0/12</span></span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stage-card" data-stage="4">
                            <div class="stage-icon">üèÜ</div>
                            <h3>ÊåëÊàòÂÖ≥Âç°</h3>
                            <p>ÁªºÂêàËøêÁî®</p>
                            <div class="stage-progress">
                                <span class="progress-text">ËøõÂ∫¶: <span class="progress-count">0/6</span></span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="continueBtn" class="btn btn-primary">ÁªßÁª≠Â≠¶‰π†</button>
                        <button id="newGameBtn" class="btn btn-secondary">ÈáçÊñ∞ÂºÄÂßã</button>
                        <button id="helpBtn" class="btn btn-info">Ê∏∏ÊàèËØ¥Êòé</button>
                    </div>
                </div>
            </div>

            <!-- Ê∏∏ÊàèÁïåÈù¢ -->
            <div id="gameScreen" class="screen">
                <!-- ÂÖ≥Âç°‰ø°ÊÅØ -->
                <div class="level-header">
                    <div class="level-title">
                        <h2 id="levelTitle">ÂÖ≥Âç°Ê†áÈ¢ò</h2>
                        <p id="levelDescription">ÂÖ≥Âç°ÊèèËø∞</p>
                    </div>
                    <div class="level-progress">
                        <div class="hearts">
                            <span class="heart active">‚ù§Ô∏è</span>
                            <span class="heart active">‚ù§Ô∏è</span>
                            <span class="heart active">‚ù§Ô∏è</span>
                        </div>
                        <div class="game-controls">
                            <button id="pauseGame" class="btn btn-small">ÊöÇÂÅú</button>
                            <button id="getHint" class="btn btn-small">ÊèêÁ§∫</button>
                            <button id="resetLevel" class="btn btn-small">ÈáçÁΩÆ</button>
                            <button id="backToStart" class="btn btn-small">ËøîÂõû</button>
                        </div>
                    </div>
                    <div class="game-stats">
                        <span id="scoreDisplay">ÂæóÂàÜ: 0</span>
                        <span id="livesDisplay">ÁîüÂëΩ: 3</span>
                        <span id="hintsDisplay">ÊèêÁ§∫: 3</span>
                        <span id="levelDisplay">Á¨¨1ÂÖ≥</span>
                    </div>
                    <div id="progressBar" class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Ê∏∏ÊàèÂÜÖÂÆπÂå∫ -->
                <div id="gameContent" class="game-content">
                    <!-- Â§©Âπ≥Ê∏∏Êàè -->
                    <div id="balanceGame" class="game-type">
                        <div class="balance-container">
                            <div class="balance-beam">
                                <div class="balance-left" id="balanceLeft">
                                    <div class="balance-plate"></div>
                                    <div class="balance-items" id="leftItems"></div>
                                </div>
                                <div class="balance-center">
                                    <div class="balance-fulcrum"></div>
                                </div>
                                <div class="balance-right" id="balanceRight">
                                    <div class="balance-plate"></div>
                                    <div class="balance-items" id="rightItems"></div>
                                </div>
                            </div>
                        </div>
                        <div class="item-bank" id="itemBank">
                            <!-- ÂèØÊãñÊãΩÁöÑÁâ©ÂìÅ -->
                        </div>
                    </div>

                    <!-- È≠îÊ≥ïÁõíÂ≠êÊ∏∏Êàè -->
                    <div id="magicBoxGame" class="game-type">
                        <div class="equation-display">
                            <div class="equation-parts" id="equationParts">
                                <!-- ÊñπÁ®ãÁªÑ‰ª∂ -->
                            </div>
                        </div>
                        <div class="magic-box-container">
                            <div class="magic-box" id="magicBox">
                                <div class="box-content">?</div>
                            </div>
                        </div>
                    </div>

                    <!-- ÊïÖ‰∫ãÊñπÁ®ãÊ∏∏Êàè -->
                    <div id="storyGame" class="game-type">
                        <div class="story-container">
                            <div class="story-text" id="storyText">
                                <!-- ÊïÖ‰∫ãÂÜÖÂÆπ -->
                            </div>
                            <div class="story-question" id="storyQuestion">
                                <!-- ÈóÆÈ¢ò -->
                            </div>
                        </div>
                        <div class="equation-builder" id="equationBuilder">
                            <!-- ÊñπÁ®ãÊûÑÂª∫Âô® -->
                        </div>
                    </div>
                </div>

                <!-- Á≠îÈ¢òÂå∫Âüü -->
                <div id="answerArea" class="answer-area">
                    <div class="answer-input-group">
                        <label for="answerInput">‰Ω†ÁöÑÁ≠îÊ°à:</label>
                        <input type="text" id="answerInput" class="answer-input" placeholder="ËØ∑ËæìÂÖ•Á≠îÊ°à">
                        <button id="submitAnswer" class="btn btn-primary">Êèê‰∫§Á≠îÊ°à</button>
                    </div>
                </div>

                <!-- ÂèçÈ¶àÂå∫Âüü -->
                <div id="feedbackArea" class="feedback-area">
                    <div class="feedback-content"></div>
                </div>
                <div class="answer-section">
                    <div class="answer-input">
                        <label for="answerField">‰Ω†ÁöÑÁ≠îÊ°àÔºö</label>
                        <input type="number" id="answerField" placeholder="ËØ∑ËæìÂÖ•Á≠îÊ°à">
                        <span class="answer-unit" id="answerUnit"></span>
                    </div>
                    <div class="answer-buttons">
                        <button id="submitBtn" class="btn btn-primary">Êèê‰∫§Á≠îÊ°à</button>
                        <button id="hintBtn" class="btn btn-secondary">ÊèêÁ§∫</button>
                        <button id="skipBtn" class="btn btn-warning">Ë∑≥Ëøá</button>
                    </div>
                </div>

                <!-- ÂèçÈ¶àÂå∫Âüü -->
                <div id="feedback" class="feedback hidden">
                    <div class="feedback-content">
                        <div class="feedback-icon"></div>
                        <div class="feedback-text"></div>
                        <div class="feedback-explanation"></div>
                    </div>
                </div>
            </div>

            <!-- ÁªìÊûúÁïåÈù¢ -->
            <div id="resultScreen" class="screen">
                <div class="result-container">
                    <div class="result-header">
                        <div class="result-icon" id="resultIcon"></div>
                        <h2 class="result-title" id="resultTitle"></h2>
                    </div>
                    <div class="result-stats">
                        <div class="stat-item">
                            <span class="stat-label">Ê≠£Á°ÆÁéá</span>
                            <span class="stat-value" id="accuracyRate">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Áî®Êó∂</span>
                            <span class="stat-value" id="timeSpent">0Áßí</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ÂæóÂàÜ</span>
                            <span class="stat-value" id="levelScore">0ÂàÜ</span>
                        </div>
                    </div>
                    <div class="result-actions">
                        <button id="nextLevelBtn" class="btn btn-primary">‰∏ã‰∏ÄÂÖ≥</button>
                        <button id="retryBtn" class="btn btn-secondary">ÈáçËØï</button>
                        <button id="backToMenuBtn" class="btn btn-info">ËøîÂõû‰∏ªËèúÂçï</button>
                    </div>
                </div>
            </div>

            <!-- Â∏ÆÂä©ÁïåÈù¢ -->
            <div id="helpScreen" class="screen">
                <div class="help-container">
                    <h2>Ê∏∏ÊàèËØ¥Êòé</h2>
                    <div class="help-content">
                        <div class="help-section">
                            <h3>üéØ Ê∏∏ÊàèÁõÆÊ†á</h3>
                            <p>ÈÄöËøáÊúâË∂£ÁöÑÊ∏∏ÊàèÔºåÂ≠¶‰ºöÁî®ÊñπÁ®ãÁöÑÊÄùÁª¥Ëß£ÂÜ≥Êï∞Â≠¶ÈóÆÈ¢ò„ÄÇ</p>
                        </div>
                        <div class="help-section">
                            <h3>‚öñÔ∏è Â§©Âπ≥Ê∏∏Êàè</h3>
                            <p>ÊãñÊãΩÁâ©ÂìÅÂà∞Â§©Âπ≥‰∏§ËæπÔºåÁêÜËß£Á≠âÈáèÂÖ≥Á≥ªÁöÑÊ¶ÇÂøµ„ÄÇ</p>
                        </div>
                        <div class="help-section">
                            <h3>üì¶ È≠îÊ≥ïÁõíÂ≠ê</h3>
                            <p>ÁåúÊµãÁõíÂ≠êÈáåÁöÑÊï∞ÈáèÔºåÂ≠¶‰π†Áî®Â≠óÊØçË°®Á§∫Êú™Áü•Êï∞„ÄÇ</p>
                        </div>
                        <div class="help-section">
                            <h3>üìö ÊïÖ‰∫ãÊñπÁ®ã</h3>
                            <p>‰ªéÁîüÊ¥ªÊïÖ‰∫ã‰∏≠ÊâæÂá∫Êï∞ÈáèÂÖ≥Á≥ªÔºåÂàóÂá∫ÊñπÁ®ã„ÄÇ</p>
                        </div>
                        <div class="help-section">
                            <h3>üèÜ ÊåëÊàòÂÖ≥Âç°</h3>
                            <p>ÁªºÂêàËøêÁî®ÊâÄÂ≠¶Áü•ËØÜÔºåËß£ÂÜ≥Â§çÊùÇÈóÆÈ¢ò„ÄÇ</p>
                        </div>
                    </div>
                    <button id="backToStart" class="btn btn-primary">ËøîÂõû‰∏ªËèúÂçï</button>
                </div>
            </div>
        </main>

        <!-- Â∫ïÈÉ®‰ø°ÊÅØ -->
        <footer id="gameFooter">
            <div class="footer-content">
                <p>&copy; 2024 Â≠¶ÊñπÁ®ãÂ∞èÊ∏∏Êàè - ËÆ©Êï∞Â≠¶Â≠¶‰π†Êõ¥ÊúâË∂£</p>
            </div>
        </footer>
    </div>

    <!-- Âä†ËΩΩÊèêÁ§∫ -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Ê∏∏ÊàèÂä†ËΩΩ‰∏≠...</p>
    </div>

    <!-- JavaScriptÊñá‰ª∂ -->
    <script src="js/utils.js"></script>
    <script src="js/levels.js"></script>
    <script src="js/balance.js"></script>
    <script src="js/magicbox.js"></script>
    <script src="js/story.js"></script>
    <script src="js/game.js"></script>
    
    <script>
        // Â£∞ÊòéÂÖ®Â±ÄÊ∏∏ÊàèÂèòÈáè
        let game;
        
        // ÈîôËØØÂ§ÑÁêÜ
        window.addEventListener('error', function(e) {
            console.error('JavaScriptÈîôËØØ:', e.error);
            console.error('Êñá‰ª∂:', e.filename);
            console.error('Ë°åÂè∑:', e.lineno);
            console.error('ÂàóÂè∑:', e.colno);
        });
        
        // Ê∏∏ÊàèÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('ÂºÄÂßãÂàùÂßãÂåñÊ∏∏Êàè...');
                
                // Ê£ÄÊü•ÂøÖË¶ÅÁöÑÁ±ªÊòØÂê¶Â≠òÂú®
                if (typeof EquationGame === 'undefined') {
                    throw new Error('EquationGameÁ±ªÊú™ÂÆö‰πâ');
                }
                if (typeof BalanceGame === 'undefined') {
                    throw new Error('BalanceGameÁ±ªÊú™ÂÆö‰πâ');
                }
                if (typeof MagicBoxGame === 'undefined') {
                    throw new Error('MagicBoxGameÁ±ªÊú™ÂÆö‰πâ');
                }
                if (typeof StoryGame === 'undefined') {
                    throw new Error('StoryGameÁ±ªÊú™ÂÆö‰πâ');
                }
                if (typeof Storage === 'undefined') {
                    throw new Error('StorageÂ∑•ÂÖ∑Á±ªÊú™ÂÆö‰πâ');
                }
                if (typeof DOMUtils === 'undefined') {
                    throw new Error('DOMUtilsÂ∑•ÂÖ∑Á±ªÊú™ÂÆö‰πâ');
                }
                if (typeof Debug === 'undefined') {
                    throw new Error('DebugÂ∑•ÂÖ∑Á±ªÊú™ÂÆö‰πâ');
                }
                
                console.log('ÊâÄÊúâÂøÖË¶ÅÁöÑÁ±ªÈÉΩÂ∑≤Âä†ËΩΩ');
                
                // ÂàùÂßãÂåñÂÖ®Â±ÄÊ∏∏ÊàèÂØπË±°
                game = new EquationGame();
                game.init();
                
                console.log('Ê∏∏ÊàèÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('Ê∏∏ÊàèÂàùÂßãÂåñÂ§±Ë¥•:', error);
                document.body.innerHTML = '<div style="padding: 20px; text-align: center; color: red;"><h2>Ê∏∏ÊàèÂä†ËΩΩÂ§±Ë¥•</h2><p>' + error.message + '</p><p>ËØ∑Ê£ÄÊü•ÊµèËßàÂô®ÊéßÂà∂Âè∞Ëé∑ÂèñËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ</p></div>';
            }
        });
    </script>
</body>
</html>